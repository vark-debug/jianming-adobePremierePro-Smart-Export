# 开发和测试指南

## 开发环境设置

### 1. 安装依赖
```bash
yarn
# 或
npm install
```

### 2. 启动开发模式
```bash
yarn dev
```

这会启动 Vite 开发服务器，启用热重载功能。文件会被构建到 `dist/` 目录。

### 3. 在 UDT 中加载插件
1. 打开 Adobe UXP Developer Tool (UDT)
2. 点击 "Add Plugin..."
3. 选择 `dist/manifest.json`
4. 点击 "Load"
5. 在 Premiere Pro 中，选择 `窗口 > 扩展 > 快速导出`

### 4. 调试
- 在 UDT 中点击插件旁边的 "Debug" 按钮
- 会打开 Chrome DevTools，可以查看 console.log 输出
- 修改代码后保存，插件会自动重新加载

## 测试流程

### 基础功能测试

1. **项目信息加载测试**
   - 打开一个已保存的 Premiere Pro 项目
   - 启动插件
   - 验证项目名称是否正确显示
   - 验证导出路径是否正确（项目父目录/导出）

2. **分辨率检测测试**
   - 测试 1080p 序列（应显示 `_10mbps`）
   - 测试 4K 序列（应显示 `_48mbps`）

3. **版本号检测测试**
   - 情况1：导出文件夹为空 → 应显示 `_V1`
   - 情况2：已有 `项目_10mbps_V2.mp4` → 应显示 `_V3`
   - 情况3：已有中文版本 `项目_第一版.mp4` → 应显示 `_第二版`

4. **自定义项目名称测试**
   - 修改项目名称输入框
   - 点击刷新
   - 验证版本号是否保持延续

5. **调色状态测试**
   - 情况1：导出文件夹中有 `项目_V1_已调色.mp4` → UI 应自动选中"已调色"
   - 情况2：手动切换调色状态 → 验证显示框是否更新

6. **导出测试**
   - 测试 H.264 导出（默认）
   - 测试 ProRes 422 导出
   - 测试 ProRes 444 导出
   - 验证文件名格式：`项目名_码率_版本号_调色状态.扩展名`

7. **打开文件夹测试**
   - 点击"打开导出文件夹"按钮
   - 验证是否在系统文件管理器中正确打开

### 边界情况测试

1. **项目未保存**
   - 创建新项目但不保存
   - 启动插件 → 应提示"项目尚未保存"

2. **无活动序列**
   - 关闭所有序列
   - 尝试导出 → 应提示"没有活动的序列"

3. **特殊字符文件名**
   - 测试包含日期的项目名（如 `项目_2025-1-21.prproj`）
   - 验证是否正确清理日期标记

4. **路径兼容性**
   - Windows: 测试 `C:\Users\...` 路径
   - macOS: 测试 `/Users/...` 路径

## 常见问题排查

### 问题：插件无法加载
- 检查 `dist/manifest.json` 是否存在
- 检查是否运行了 `yarn dev` 或 `yarn build`
- 查看 UDT 日志输出

### 问题：热重载不工作
- 检查端口 8080 是否被占用
- 确认 `uxp.config.ts` 中的 `hotReloadPort` 配置
- 重启 UDT 和 Premiere Pro

### 问题：找不到预设文件
- 确认 `public/epr/` 目录下有 `.epr` 文件
- 检查文件名是否匹配（区分大小写）
- 查看 console.log 输出的路径信息

### 问题：导出失败
- 检查 Chrome DevTools Console 的错误信息
- 确认预设文件路径是否正确
- 验证导出文件夹是否有写入权限

## 生产构建

### 构建插件
```bash
yarn build
```

### 打包为 CCX
```bash
yarn ccx
```

这会生成 `.ccx` 文件，可用于通过 Adobe Creative Cloud 分发。

### 打包为 ZIP
```bash
yarn zip
```

这会生成 ZIP 归档，包含 `public-zip/` 目录中的附加资源。

## 代码风格

- 使用 TypeScript 严格模式
- 使用 async/await 处理异步操作
- 所有模块函数返回统一的结果对象格式：
  ```typescript
  {
    success: boolean;
    data?: any;
    error: string | null;
  }
  ```
- 使用详细的 console.log 输出调试信息
- 变量和函数使用驼峰命名法

## 性能优化建议

1. 文件遍历可能较慢，考虑添加进度提示
2. 大型项目可能有很多视频文件，考虑限制遍历深度
3. 导出过程较长，考虑添加进度条或状态更新
